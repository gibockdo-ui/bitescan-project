<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUSIMUSI í”„ë¡œí† íƒ€ì…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto+Sans+KR', sans-serif;
        }
        .step { display: none; }
        .step.active { display: block; }
        .symptom-btn.selected {
            background-color: #eef0ff;
            border-color: #4154FF;
            color: #4154FF;
        }
        .accordion-content { display: none; }
        .accordion-header.active + .accordion-content { display: block; }
        .spinner { animation: spin 1s linear infinite; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-md bg-white rounded-2xl shadow-lg overflow-hidden">
        <!-- Header -->
        <div class="header bg-[#4154FF] text-white p-5 text-center">
            <h1 class="text-2xl font-bold">MUSIMUSI</h1>
        </div>
        
        <div class="content p-6 md:p-8">

            <!-- Step 1: Home -->
            <div id="step1" class="step active">
                <h2 class="text-xl font-bold text-slate-800 mb-3">ì—¬í–‰ ì¤‘ ë²Œë ˆì— ë¬¼ë¦¬ì…¨ë‚˜ìš”?</h2>
                <p class="text-slate-600 mb-6">ì‚¬ì§„ í•œ ì¥ìœ¼ë¡œ ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•˜ê³  ëŒ€ì²˜í•˜ì„¸ìš”. AI ë¶„ì„, ì‘ê¸‰ì²˜ì¹˜, ì•½êµ­ ê°€ì´ë“œë¶€í„° í˜¸í…” ë£¸ ë³€ê²½ ìš”ì²­ê¹Œì§€ ë„ì™€ë“œë¦½ë‹ˆë‹¤.</p>
                <button class="w-full bg-[#4154FF] text-white font-bold py-3 px-4 rounded-lg transition-all hover:brightness-95" onclick="showStep(2)">ì§€ê¸ˆ ë°”ë¡œ ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
            </div>

            <!-- Step 2: Upload -->
            <div id="step2" class="step">
                <h2 class="text-xl font-bold text-slate-800 mb-3">Step 1. ì‚¬ì§„ ì—…ë¡œë“œ</h2>
                <p class="text-slate-600 mb-6">ìƒì²˜ ë¶€ìœ„ë‚˜ ë°œê²¬í•œ ë²Œë ˆ ì‚¬ì§„ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.</p>
                
                <input type="file" id="imageUpload" accept="image/*" capture="environment" class="hidden">
                <label for="imageUpload" class="w-full text-center block bg-[#4154FF] text-white font-bold py-3 px-4 rounded-lg transition-all hover:brightness-95 cursor-pointer">
                    ì¹´ë©”ë¼ ì´¬ì˜ / ì•¨ë²”ì—ì„œ ì„ íƒ
                </label>

                <div class="mt-4 border border-dashed border-slate-300 rounded-lg p-4 min-h-[200px] flex justify-center items-center">
                    <img id="imagePreview" class="hidden max-w-full max-h-48 rounded-md" src="#" alt="Image preview" />
                    <span id="previewText" class="text-slate-400">ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</span>
                </div>
                
                <button id="nextToSymptomsBtn" class="w-full bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600 transition-colors mt-4 hidden" onclick="showStep(3)">ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
            </div>

            <!-- Step 3: Symptoms -->
            <div id="step3" class="step">
                <h2 class="text-xl font-bold text-slate-800 mb-3">Step 2. ì¦ìƒ ì„ íƒ</h2>
                <p class="text-slate-600 mb-6">í˜„ì¬ ëŠë¼ëŠ” ì¦ìƒì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="symptom-btn border border-slate-300 rounded-lg p-3 text-center cursor-pointer" onclick="toggleSymptom(this)">ê°€ë ¤ì›€</div>
                    <div class="symptom-btn border border-slate-300 rounded-lg p-3 text-center cursor-pointer" onclick="toggleSymptom(this)">í†µì¦</div>
                    <div class="symptom-btn border border-slate-300 rounded-lg p-3 text-center cursor-pointer" onclick="toggleSymptom(this)">ë¶“ê¸°</div>
                    <div class="symptom-btn border border-slate-300 rounded-lg p-3 text-center cursor-pointer" onclick="toggleSymptom(this)">ë¬¼ì§‘</div>
                    <div class="symptom-btn border border-slate-300 rounded-lg p-3 text-center cursor-pointer" onclick="toggleSymptom(this)">ì—´ê°</div>
                    <div class="symptom-btn border border-slate-300 rounded-lg p-3 text-center cursor-pointer" onclick="toggleSymptom(this)">ì—†ìŒ</div>
                </div>
                <button class="w-full bg-[#4154FF] text-white font-bold py-3 px-4 rounded-lg transition-all hover:brightness-95" onclick="startAnalysis()">ë¶„ì„ ê²°ê³¼ ë³´ê¸°</button>
            </div>
            
            <!-- Step 4: Loading -->
            <div id="step4" class="step">
                <div class="text-center py-10">
                    <div class="spinner w-12 h-12 border-4 border-slate-200 border-t-[#4154FF] rounded-full mx-auto mb-4"></div>
                    <p class="text-slate-600">AIê°€ ìƒì²˜ì™€ ì¦ìƒì„<br>ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
            </div>

            <!-- Step 5: Results -->
            <div id="step5" class="step">
                <h2 class="text-xl font-bold text-slate-800 mb-4">AI ì¢…í•© ë¶„ì„ ê²°ê³¼</h2>
                <div id="result-summary" class="mb-4"></div>
                <div class="space-y-3">
                    <!-- Accordion Items -->
                     <div class="accordion-item border border-slate-200 rounded-lg">
                        <div class="accordion-header p-4 cursor-pointer font-semibold flex justify-between items-center" onclick="toggleAccordion(this)">
                            <span>ì‘ê¸‰ì²˜ì¹˜ ê°€ì´ë“œ</span><span class="transform transition-transform duration-300">â–¼</span>
                        </div>
                        <div class="accordion-content p-4 border-t border-slate-200 text-slate-600">
                            <p>1. íë¥´ëŠ” ê¹¨ë—í•œ ë¬¼ê³¼ ë¹„ëˆ„ë¡œ ìƒì²˜ ë¶€ìœ„ë¥¼ ì”»ì–´ì£¼ì„¸ìš”.</p>
                            <p>2. ê¹¨ë—í•œ ìˆ˜ê±´ìœ¼ë¡œ ê°ì‹¼ ì–¼ìŒìœ¼ë¡œ 10ë¶„ê°„ ëƒ‰ì°œì§ˆì„ í•˜ì„¸ìš”.</p>
                            <p>3. ê°€ë µë”ë¼ë„ ì ˆëŒ€ ê¸ì§€ ë§ˆì„¸ìš”. 2ì°¨ ê°ì—¼ì˜ ì›ì¸ì´ ë©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                    <div class="accordion-item border border-slate-200 rounded-lg">
                        <div class="accordion-header p-4 cursor-pointer font-semibold flex justify-between items-center" onclick="toggleAccordion(this)">
                            <span>í˜¸í…” ëŒ€ì²˜ ê°€ì´ë“œ</span><span class="transform transition-transform duration-300">â–¼</span>
                        </div>
                        <div class="accordion-content p-4 border-t border-slate-200 text-slate-600">
                            <h4 class="font-bold mb-2">ìƒí™© ì„¤ëª… ë° ë°©ì—­ ìš”ì²­</h4>
                            <pre id="script1" class="bg-slate-100 p-3 rounded-md text-sm whitespace-pre-wrap">Hello, I believe I was bitten by a bug in my room (Room #____). Could you please send someone to inspect and disinfect the room immediately?</pre>
                            <button class="bg-green-600 text-white text-xs font-bold py-1 px-3 rounded-md mt-2 hover:bg-green-700" onclick="copyScript('script1')">ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬</button>
                            <h4 class="font-bold mt-4 mb-2">ë£¸ ë³€ê²½ ìš”ì²­</h4>
                            <pre id="script2" class="bg-slate-100 p-3 rounded-md text-sm whitespace-pre-wrap">I was bitten by a bug in my room and I have a photo of the bite. For my safety and hygiene, I would like to request a room change immediately. Could you please arrange a new room for me?</pre>
                            <button class="bg-green-600 text-white text-xs font-bold py-1 px-3 rounded-md mt-2 hover:bg-green-700" onclick="copyScript('script2')">ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬</button>
                        </div>
                    </div>
                    <div class="accordion-item border border-slate-200 rounded-lg">
                        <div class="accordion-header p-4 cursor-pointer font-semibold flex justify-between items-center" onclick="toggleAccordion(this)">
                            <span>ì•½êµ­/ë³‘ì› ë°©ë¬¸ ê°€ì´ë“œ</span><span class="transform transition-transform duration-300">â–¼</span>
                        </div>
                        <div class="accordion-content p-4 border-t border-slate-200 text-slate-600">
                             <p><b>- ì—°ê³ :</b> <span class="text-[#4154FF] font-mono">Hydrocortisone 1% cream</span></p>
                             <p><b>- ì•Œë ˆë¥´ê¸° ì•½:</b> <span class="text-[#4154FF] font-mono">Loratadine or Cetirizine</span></p>
                             <div class="mt-6 pt-4 border-t border-slate-200">
                                <h4 class="font-bold mb-2">ë‚´ ì£¼ë³€ ì˜ë£Œì‹œì„¤ ì°¾ê¸°</h4>
                                <div class="flex space-x-3">
                                    <a href="https://www.google.com/maps/search/?api=1&query=pharmacy+near+me" target="_blank" class="flex-1 text-center bg-teal-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-600 no-underline">ì£¼ë³€ ì•½êµ­ ì°¾ê¸° ğŸ¥</a>
                                    <a href="https://www.google.com/maps/search/?api=1&query=hospital+near+me" target="_blank" class="flex-1 text-center bg-rose-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-rose-600 no-underline">ì£¼ë³€ ë³‘ì› ì°¾ê¸° ğŸš‘</a>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
                 <button class="w-full bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600 mt-6" onclick="showStep(1)">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const steps = document.querySelectorAll('.step');

        function showStep(stepNumber) {
            steps.forEach(step => step.classList.remove('active'));
            document.getElementById(`step${stepNumber}`).classList.add('active');
            currentStep = stepNumber;
        }

        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const previewText = document.getElementById('previewText');
        const nextToSymptomsBtn = document.getElementById('nextToSymptomsBtn');

        imageUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    previewText.classList.add('hidden');
                    nextToSymptomsBtn.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        function toggleSymptom(element) {
            element.classList.toggle('selected');
        }

        function startAnalysis() {
            showStep(4);
            const imageData = imagePreview.src;
            
            // ì‹œë®¬ë ˆì´ì…˜ í•¨ìˆ˜ ëŒ€ì‹  ì‹¤ì œ Roboflow API í˜¸ì¶œ í•¨ìˆ˜ë¡œ ë³€ê²½
            callRoboflowApi(imageData)
                .then(apiResult => {
                    generateResultsFromApi(apiResult);
                })
                .catch(error => {
                    console.error("API Error:", error);
                    // ì—ëŸ¬ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                    const errorResult = {
                        riskClass: 'bg-gray-200 border-gray-500 text-gray-800',
                        riskText: 'ë¶„ì„ ì‹¤íŒ¨',
                        insect: 'ì•Œ ìˆ˜ ì—†ìŒ',
                        summary: 'AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì‚¬ì§„ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
                    };
                    generateResults(errorResult);
                });
        }

        // --- Roboflow API í˜¸ì¶œì„ ìœ„í•œ ì‹¤ì œ í•¨ìˆ˜ ---
        async function callRoboflowApi(imageData) {
            // ğŸš¨ ì¤‘ìš”: ì´ API í‚¤ëŠ” Roboflowì—ì„œ ë°œê¸‰ë°›ì€ ë³¸ì¸ì˜ í‚¤ë¡œ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤.
            // ğŸš¨ ë³´ì•ˆ ê²½ê³ : ì´ í‚¤ë¥¼ HTMLì— ì§ì ‘ ë…¸ì¶œí•˜ëŠ” ê²ƒì€ ë§¤ìš° ìœ„í—˜í•©ë‹ˆë‹¤.
            // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
            const API_KEY = "YOUR_ROBOFLOW_API_KEY"; // â¬…ï¸ ì—¬ê¸°ì— ìì‹ ì˜ Roboflow API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
            const MODEL_ENDPOINT = "insect-bites/1"; // Roboflow ëª¨ë¸ ì •ë³´

            // Base64 ë°ì´í„°ì—ì„œ ìˆœìˆ˜í•œ ì´ë¯¸ì§€ ë°ì´í„° ë¶€ë¶„ë§Œ ì¶”ì¶œ
            const base64Image = imageData.split(',')[1];

            console.log("Roboflow APIë¡œ ì‹¤ì œ ë¶„ì„ì„ ìš”ì²­í•©ë‹ˆë‹¤...");

            const response = await fetch(
                `https://detect.roboflow.com/${MODEL_ENDPOINT}?api_key=${API_KEY}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: base64Image
                }
            );
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            console.log("API ë¶„ì„ ê²°ê³¼:", result);
            return result;
        }

        // --- API ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ë‚´ìš©ì„ ê°€ê³µí•˜ëŠ” í•¨ìˆ˜ ---
        function generateResultsFromApi(apiResult) {
            // APIê°€ ë¶„ì„ ê²°ê³¼ë¥¼ ì£¼ì§€ ì•Šì•˜ê±°ë‚˜, ì•„ë¬´ê²ƒë„ ì°¾ì§€ ëª»í•œ ê²½ìš°
            if (!apiResult || !apiResult.predictions || apiResult.predictions.length === 0) {
                const noResult = {
                    riskClass: 'bg-gray-200 border-gray-500 text-gray-800',
                    riskText: 'íŒë… ë¶ˆê°€',
                    insect: 'ì•Œ ìˆ˜ ì—†ìŒ',
                    summary: 'ì‚¬ì§„ì—ì„œ ë²Œë ˆë‚˜ ìƒì²˜ë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë” ì„ ëª…í•˜ê±°ë‚˜ ë‹¤ë¥¸ ê°ë„ì˜ ì‚¬ì§„ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
                };
                generateResults(noResult);
                return;
            }

            // ê°€ì¥ í™•ë¥ ì´ ë†’ì€ ì˜ˆì¸¡ ê²°ê³¼ í•˜ë‚˜ë¥¼ ì‚¬ìš©
            const prediction = apiResult.predictions[0];
            const insectClass = prediction.class; // ì˜ˆ: "Bed-Bug", "Mosquito-bite"

            // API ê²°ê³¼(ì˜ì–´)ë¥¼ ì‚¬ìš©ì ì¹œí™”ì ì¸ í•œêµ­ì–´ ì •ë³´ë¡œ ë³€í™˜
            const resultMapping = {
                'Bed-Bug': { riskClass: 'bg-yellow-100 border-yellow-500 text-yellow-800', riskText: 'ì£¼ì˜: ì¦ìƒ ê´€ì°° ë° ëŒ€ì²˜ í•„ìš”', insect: 'ë¹ˆëŒ€ (Bed Bug)', summary: 'ì‹¬ê°í•œ ì§ˆë³‘ì„ ì˜®ê¸°ì§„ ì•Šì§€ë§Œ, ì‹¬í•œ ê°€ë ¤ì›€ì¦ê³¼ ì•Œë ˆë¥´ê¸° ë°˜ì‘ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ í”¼í•´ ë°©ì§€ë¥¼ ìœ„í•´ í˜¸í…” ì¸¡ì— ì¦‰ì‹œ ì•Œë¦¬ê³  ë£¸ ë³€ê²½ì„ ìš”ì²­í•˜ì„¸ìš”.'},
                'Mosquito-bite': { riskClass: 'bg-green-100 border-green-500 text-green-800', riskText: 'ì•ˆì „: ìê°€ ì²˜ì¹˜ ê°€ëŠ¥', insect: 'ëª¨ê¸° (Mosquito)', summary: 'ì¼ë°˜ì ì¸ ëª¨ê¸° ë¬¼ë¦¼ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ê°€ë µë”ë¼ë„ ê¸ì§€ ë§ê³ , ëƒ‰ì°œì§ˆì´ë‚˜ ì•½êµ­ ì—°ê³ ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.'},
                // ì—¬ê¸°ì— Roboflow ëª¨ë¸ì´ ì¸ì‹í•˜ëŠ” ë‹¤ë¥¸ ë²Œë ˆ ì¢…ë¥˜ë“¤ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                'default': { riskClass: 'bg-red-100 border-red-500 text-red-800', riskText: 'ìœ„í—˜: ê°€ê¹Œìš´ ë³‘ì› ë°©ë¬¸ ê¶Œì¥', insect: `ì•Œ ìˆ˜ ì—†ëŠ” ë²Œë ˆ (${insectClass})`, summary: 'ì•Œë ¤ì§€ì§€ ì•Šì€ ë²Œë ˆì´ê±°ë‚˜ ë…ì„±ì´ ì˜ì‹¬ë©ë‹ˆë‹¤. ì •í™•í•œ ì§„ë‹¨ì„ ìœ„í•´ ê°€ê¹Œìš´ ë³‘ì›ì„ ë°©ë¬¸í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.'}
            };

            const finalResult = resultMapping[insectClass] || resultMapping['default'];
            generateResults(finalResult);
        }

        // --- ìµœì¢… ê²°ê³¼ë¥¼ í™”ë©´ì— ê·¸ë ¤ì£¼ëŠ” í•¨ìˆ˜ ---
        function generateResults(result) {
            const resultSummary = document.getElementById('result-summary');
            resultSummary.innerHTML = `
                <div class="result-card border-l-4 p-4 rounded-r-lg ${result.riskClass}">
                    <h3 class="font-bold mb-1">${result.riskText}</h3>
                    <p class="text-sm"><strong>AI ì¶”ì • ë²Œë ˆ: ${result.insect}</strong></p>
                </div>
                <p class="text-slate-600 mt-4">${result.summary}</p>
                <p class="text-xs text-slate-400 mt-4">â€» ì´ ë¶„ì„ì€ ì˜í•™ì  ì§„ë‹¨ì´ ì•„ë‹ˆë©°, ì‘ê¸‰ì²˜ì¹˜ ë° ëŒ€ì²˜ë¥¼ ë•ê¸° ìœ„í•œ AI ì¶”ì •ì¹˜ì…ë‹ˆë‹¤.</p>
            `;
            showStep(5);
        }

        function toggleAccordion(header) {
            header.classList.toggle('active');
            const icon = header.querySelector('span:last-child');
            icon.classList.toggle('rotate-180');
        }

        function copyScript(scriptId) {
            const textToCopy = document.getElementById(scriptId).innerText;
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('ìŠ¤í¬ë¦½íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (err) { console.error('Fallback: Oops, unable to copy', err); }
            document.body.removeChild(textArea);
        }
        
        showStep(1);
    </script>
</body>
</html>
